<!-- Mil Pomodoro Timer -->
<!-- Simple Pomodoro Timer with continues timers for tasts and pauses by Mil Stamenkoviƒá -->
<!-- Version A -->
<!-- ¬© 2026 Mil Stamenkoviƒá -->
<!-- Created with help of Claude AI -->
<!-- Created: 23.02.2026. - ƒÜuprija, Serbia -->
<!-- Revised: 23.02.2026. - ƒÜuprija, Serbia -->

<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Task Timer</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0f0f0f;
    --surface: #1a1a1a;
    --border: #2a2a2a;
    --accent: #e8c547;
    --pause-accent: #6bc5a8;
    --text: #f0ede6;
    --muted: #666;
    --danger: #e05252;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg);
    color: var(--text);
    font-family: 'DM Mono', monospace;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 40px 20px;
    position: relative;
    overflow-x: hidden;
  }

  body::before {
    content: '';
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    background: radial-gradient(ellipse at 20% 50%, rgba(232,197,71,0.03) 0%, transparent 60%),
                radial-gradient(ellipse at 80% 20%, rgba(107,197,168,0.03) 0%, transparent 60%);
    pointer-events: none;
  }

  h1 {
    font-family: 'Playfair Display', serif;
    font-size: 2rem;
    letter-spacing: -0.5px;
    margin-bottom: 8px;
    color: var(--text);
  }

  .subtitle {
    font-size: 0.7rem;
    color: var(--muted);
    letter-spacing: 3px;
    text-transform: uppercase;
    margin-bottom: 48px;
  }

  /* ‚îÄ‚îÄ EDITOR ‚îÄ‚îÄ */
  #editor {
    width: 100%;
    max-width: 560px;
  }

  .editor-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 16px;
  }

  .editor-header span {
    font-size: 0.65rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
  }

  .task-list {
    display: flex;
    flex-direction: column;
    gap: 8px;
    margin-bottom: 16px;
  }

  .task-row {
    display: flex;
    gap: 8px;
    align-items: center;
    animation: slideIn 0.2s ease;
  }

  @keyframes slideIn {
    from { opacity: 0; transform: translateY(-8px); }
    to   { opacity: 1; transform: translateY(0); }
  }

  /* Fixed-width type toggle so all rows align */
  .type-toggle {
    width: 58px;
    flex-shrink: 0;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--muted);
    font-family: 'DM Mono', monospace;
    font-size: 0.62rem;
    padding: 10px 0;
    cursor: pointer;
    letter-spacing: 1px;
    text-align: center;
    transition: all 0.2s;
  }

  .type-toggle.is-pause {
    border-color: var(--pause-accent);
    color: var(--pause-accent);
  }

  .task-row input[type="text"] {
    flex: 1;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 0.85rem;
    padding: 10px 14px;
    outline: none;
    transition: border-color 0.2s;
  }

  .task-row input[type="text"]:focus {
    border-color: var(--accent);
  }

  .task-row input[type="text"].pause-name {
    color: var(--pause-accent);
  }

  .task-row input[type="number"] {
    width: 72px;
    flex-shrink: 0;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 0.85rem;
    padding: 10px 10px;
    outline: none;
    text-align: center;
    transition: border-color 0.2s;
    -moz-appearance: textfield;
  }

  .task-row input[type="number"]::-webkit-outer-spin-button,
  .task-row input[type="number"]::-webkit-inner-spin-button { -webkit-appearance: none; }

  .task-row input[type="number"]:focus {
    border-color: var(--accent);
  }

  .task-row button.remove {
    width: 28px;
    flex-shrink: 0;
    background: none;
    border: none;
    color: var(--muted);
    cursor: pointer;
    font-size: 1.1rem;
    line-height: 1;
    padding: 4px 0;
    border-radius: 4px;
    text-align: center;
    transition: color 0.2s;
  }

  .task-row button.remove:hover { color: var(--danger); }

  .editor-actions {
    display: flex;
    gap: 8px;
  }

  button.add-task {
    flex: 1;
    background: var(--surface);
    border: 1px dashed var(--border);
    border-radius: 6px;
    color: var(--muted);
    font-family: 'DM Mono', monospace;
    font-size: 0.75rem;
    padding: 10px;
    cursor: pointer;
    letter-spacing: 1px;
    transition: all 0.2s;
  }

  button.add-task:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  button.start-btn {
    background: var(--accent);
    border: none;
    border-radius: 6px;
    color: #0f0f0f;
    font-family: 'DM Mono', monospace;
    font-size: 0.8rem;
    font-weight: 500;
    padding: 10px 28px;
    cursor: pointer;
    letter-spacing: 2px;
    text-transform: uppercase;
    transition: opacity 0.2s, transform 0.1s;
  }

  button.start-btn:hover { opacity: 0.85; transform: translateY(-1px); }
  button.start-btn:active { transform: translateY(0); }

  /* Notification permission banner */
  #notif-banner {
    display: none;
    width: 100%;
    max-width: 560px;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    padding: 12px 16px;
    margin-bottom: 16px;
    font-size: 0.72rem;
    color: var(--muted);
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 12px;
  }

  #notif-banner button {
    background: var(--accent);
    border: none;
    border-radius: 5px;
    color: #0f0f0f;
    font-family: 'DM Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 1px;
    padding: 6px 14px;
    cursor: pointer;
    white-space: nowrap;
    flex-shrink: 0;
  }

  #notif-banner.hidden { display: none !important; }

  /* ‚îÄ‚îÄ TIMER VIEW ‚îÄ‚îÄ */
  #timer-view {
    display: none;
    flex-direction: column;
    align-items: center;
    width: 100%;
    max-width: 560px;
  }

  .progress-bar-wrap {
    width: 100%;
    height: 2px;
    background: var(--border);
    border-radius: 2px;
    margin-bottom: 40px;
    overflow: hidden;
  }

  .progress-bar-fill {
    height: 100%;
    background: var(--accent);
    border-radius: 2px;
    transition: width 1s linear, background 0.5s;
    width: 0%;
  }

  .progress-bar-fill.is-pause {
    background: var(--pause-accent);
  }

  .step-label {
    font-size: 0.65rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 12px;
  }

  .step-label span {
    color: var(--accent);
  }

  .current-task-name {
    font-family: 'Playfair Display', serif;
    font-size: 2.4rem;
    text-align: center;
    margin-bottom: 8px;
    line-height: 1.2;
    transition: color 0.4s;
  }

  .current-task-name.is-pause {
    color: var(--pause-accent);
  }

  .type-badge {
    font-size: 0.6rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 40px;
  }

  .clock {
    font-size: 5.5rem;
    font-weight: 500;
    letter-spacing: -4px;
    line-height: 1;
    margin-bottom: 12px;
    transition: color 0.3s;
    font-variant-numeric: tabular-nums;
  }

  .clock.warning { color: var(--danger); }
  .clock.is-pause { color: var(--pause-accent); }

  .total-left {
    font-size: 0.7rem;
    color: var(--muted);
    letter-spacing: 1px;
    margin-bottom: 48px;
  }

  .controls {
    display: flex;
    gap: 12px;
    margin-bottom: 48px;
  }

  .ctrl-btn {
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 8px;
    color: var(--text);
    font-family: 'DM Mono', monospace;
    font-size: 0.7rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    padding: 12px 24px;
    cursor: pointer;
    transition: all 0.2s;
  }

  .ctrl-btn:hover {
    border-color: var(--accent);
    color: var(--accent);
  }

  .ctrl-btn.primary {
    background: var(--accent);
    border-color: var(--accent);
    color: #0f0f0f;
  }

  .ctrl-btn.primary:hover {
    opacity: 0.85;
    color: #0f0f0f;
  }

  /* Queue */
  .queue-title {
    font-size: 0.6rem;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--muted);
    margin-bottom: 16px;
    align-self: flex-start;
  }

  .queue {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }

  .queue-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: var(--surface);
    border: 1px solid var(--border);
    border-radius: 6px;
    padding: 10px 16px;
    font-size: 0.8rem;
    opacity: 0.4;
    transition: opacity 0.3s;
  }

  .queue-item.current {
    opacity: 1;
    border-color: var(--accent);
  }

  .queue-item.current.is-pause {
    border-color: var(--pause-accent);
  }

  .queue-item.done {
    opacity: 0.2;
    text-decoration: line-through;
  }

  .queue-item-name { flex: 1; }

  .queue-item-dur {
    color: var(--muted);
    font-size: 0.7rem;
  }

  /* Flash overlay */
  #flash {
    position: fixed;
    inset: 0;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.1s;
    z-index: 100;
  }

  #flash.active { opacity: 1; }

  .edit-link {
    margin-top: 32px;
    background: none;
    border: none;
    color: var(--muted);
    font-family: 'DM Mono', monospace;
    font-size: 0.65rem;
    letter-spacing: 2px;
    text-transform: uppercase;
    cursor: pointer;
    text-decoration: underline;
    text-underline-offset: 3px;
  }

  .edit-link:hover { color: var(--text); }

  /* Done screen */
  #done-view {
    display: none;
    flex-direction: column;
    align-items: center;
    text-align: center;
  }

  .done-big {
    font-family: 'Playfair Display', serif;
    font-size: 3rem;
    margin-bottom: 12px;
    color: var(--accent);
  }

  .done-sub {
    color: var(--muted);
    font-size: 0.8rem;
    margin-bottom: 32px;
  }
</style>
</head>
<body>

<div id="flash"></div>

<h1>Task Timer</h1>
<p class="subtitle">Focus ¬∑ Work ¬∑ Repeat</p>

<!-- Notification permission banner -->
<div id="notif-banner">
  <span>Enable Windows notifications to get alerts when each timer ends.</span>
  <button onclick="requestNotifPermission()">Enable</button>
</div>

<!-- ‚îÄ‚îÄ EDITOR ‚îÄ‚îÄ -->
<div id="editor">
  <div class="editor-header">
    <span>Your Session</span>
    <span id="total-time-label"></span>
  </div>
  <div class="task-list" id="task-list"></div>
  <div class="editor-actions">
    <button class="add-task" onclick="addTask()">+ Add Task</button>
    <button class="add-task" onclick="addPause()" style="flex:0.6">+ Pause</button>
    <button class="start-btn" onclick="startSession()">START</button>
  </div>
</div>

<!-- ‚îÄ‚îÄ TIMER ‚îÄ‚îÄ -->
<div id="timer-view">
  <div class="progress-bar-wrap">
    <div class="progress-bar-fill" id="progress-fill"></div>
  </div>
  <div class="step-label">Step <span id="step-num">1</span> of <span id="step-total">1</span></div>
  <div class="current-task-name" id="current-name">Task</div>
  <div class="type-badge" id="type-badge">TASK</div>
  <div class="clock" id="clock">00:00</div>
  <div class="total-left" id="total-left"></div>
  <div class="controls">
    <button class="ctrl-btn" id="pause-resume-btn" onclick="togglePause()">PAUSE</button>
    <button class="ctrl-btn primary" id="next-btn" onclick="nextStep()">SKIP ‚Üí</button>
  </div>
  <div class="queue-title">Up Next</div>
  <div class="queue" id="queue"></div>
  <button class="edit-link" onclick="backToEditor()">‚Üê Edit session</button>
</div>

<!-- ‚îÄ‚îÄ DONE ‚îÄ‚îÄ -->
<div id="done-view">
  <div class="done-big">Session Complete</div>
  <div class="done-sub" id="done-stats"></div>
  <button class="start-btn" onclick="backToEditor()">NEW SESSION</button>
</div>

<script>
  // ‚îÄ‚îÄ State ‚îÄ‚îÄ
  let tasks = [];
  let currentStep = 0;
  let secondsLeft = 0;
  let totalSecondsLeft = 0;
  let timerInterval = null;
  let isPaused = false;
  let stepDuration = 0;
  let stepElapsed = 0;

  // ‚îÄ‚îÄ Notifications ‚îÄ‚îÄ
  function checkNotifBanner() {
    if (!('Notification' in window)) return;
    const banner = document.getElementById('notif-banner');
    if (Notification.permission === 'default') {
      banner.style.display = 'flex';
    } else {
      banner.classList.add('hidden');
    }
  }

  function requestNotifPermission() {
    Notification.requestPermission().then(() => {
      document.getElementById('notif-banner').classList.add('hidden');
    });
  }

  function sendNotification(title, body) {
    if (!('Notification' in window) || Notification.permission !== 'granted') return;
    try {
      const n = new Notification(title, {
        body,
        icon: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14/assets/svg/23f1.svg',
        silent: false
      });
      setTimeout(() => n.close(), 8000);
    } catch(e) {}
  }

  // ‚îÄ‚îÄ Audio ‚îÄ‚îÄ
  const AudioCtx = window.AudioContext || window.webkitAudioContext;
  function beep(freq = 880, dur = 0.15, vol = 0.4, type = 'sine') {
    try {
      const ctx = new AudioCtx();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.connect(gain); gain.connect(ctx.destination);
      osc.frequency.value = freq;
      osc.type = type;
      gain.gain.setValueAtTime(vol, ctx.currentTime);
      gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + dur);
      osc.start(); osc.stop(ctx.currentTime + dur);
    } catch(e) {}
  }

  function alertSound() {
    beep(660, 0.12);
    setTimeout(() => beep(880, 0.12), 140);
    setTimeout(() => beep(1100, 0.2), 280);
  }

  function flash(color = 'rgba(232,197,71,0.18)') {
    const el = document.getElementById('flash');
    el.style.background = color;
    el.classList.add('active');
    setTimeout(() => el.classList.remove('active'), 300);
  }

  // ‚îÄ‚îÄ Editor ‚îÄ‚îÄ
  function addTask(name = '', minutes = 25) {
    tasks.push({ name, minutes, type: 'task' });
    renderEditor();
  }

  function addPause(name = 'Pause', minutes = 5) {
    tasks.push({ name, minutes, type: 'pause' });
    renderEditor();
  }

  function removeTask(i) {
    tasks.splice(i, 1);
    renderEditor();
  }

  function toggleType(i) {
    tasks[i].type = tasks[i].type === 'task' ? 'pause' : 'task';
    if (tasks[i].type === 'pause' && !tasks[i].name.trim()) tasks[i].name = 'Pause';
    renderEditor();
  }

  function renderEditor() {
    const list = document.getElementById('task-list');
    list.innerHTML = '';
    tasks.forEach((t, i) => {
      const row = document.createElement('div');
      row.className = 'task-row';
      row.innerHTML = `
        <button class="type-toggle ${t.type === 'pause' ? 'is-pause' : ''}" onclick="toggleType(${i})">
          ${t.type === 'pause' ? 'PAUSE' : 'TASK'}
        </button>
        <input type="text" placeholder="${t.type === 'pause' ? 'Pause' : 'Task name‚Ä¶'}"
               value="${escHtml(t.name)}"
               class="${t.type === 'pause' ? 'pause-name' : ''}"
               oninput="tasks[${i}].name=this.value" />
        <input type="number" min="1" max="999" value="${t.minutes}"
               oninput="tasks[${i}].minutes=Math.max(1,parseInt(this.value)||1)" />
        <button class="remove" onclick="removeTask(${i})">√ó</button>
      `;
      list.appendChild(row);
    });

    const total = tasks.reduce((s, t) => s + (parseInt(t.minutes) || 0), 0);
    const h = Math.floor(total / 60), m = total % 60;
    document.getElementById('total-time-label').textContent =
      total > 0 ? (h > 0 ? `${h}h ${m}m total` : `${m}m total`) : '';
  }

  function escHtml(s) {
    return (s||'').replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/"/g,'&quot;');
  }

  // ‚îÄ‚îÄ Session ‚îÄ‚îÄ
  function startSession() {
    const valid = tasks.filter(t => t.minutes > 0);
    if (valid.length === 0) return;
    tasks.forEach((t, i) => { if (!t.name.trim()) t.name = t.type === 'pause' ? 'Pause' : `Task ${i+1}`; });

    currentStep = 0;
    totalSecondsLeft = tasks.reduce((s, t) => s + t.minutes * 60, 0);

    document.getElementById('editor').style.display = 'none';
    document.getElementById('done-view').style.display = 'none';
    const tv = document.getElementById('timer-view');
    tv.style.display = 'flex';

    document.getElementById('step-total').textContent = tasks.length;
    renderQueue();
    startStep();
  }

  function startStep() {
    const t = tasks[currentStep];
    stepDuration = t.minutes * 60;
    secondsLeft = stepDuration;
    stepElapsed = 0;
    isPaused = false;

    const isPauseStep = t.type === 'pause';
    const nameEl = document.getElementById('current-name');
    nameEl.textContent = t.name;
    nameEl.classList.toggle('is-pause', isPauseStep);

    document.getElementById('type-badge').textContent = isPauseStep ? 'BREAK' : 'TASK';
    document.getElementById('step-num').textContent = currentStep + 1;

    const fill = document.getElementById('progress-fill');
    fill.classList.toggle('is-pause', isPauseStep);
    fill.style.width = '0%';

    document.getElementById('pause-resume-btn').textContent = 'PAUSE';

    const nextBtn = document.getElementById('next-btn');
    nextBtn.textContent = currentStep < tasks.length - 1 ? 'SKIP ‚Üí' : 'FINISH';

    updateClock();
    renderQueue();

    clearInterval(timerInterval);
    timerInterval = setInterval(tick, 1000);
  }

  function tick() {
    if (isPaused) return;
    secondsLeft--;
    totalSecondsLeft--;
    stepElapsed++;

    updateClock();

    const pct = (stepElapsed / stepDuration) * 100;
    document.getElementById('progress-fill').style.width = pct + '%';

    if (secondsLeft <= 0) {
      clearInterval(timerInterval);
      alertSound();
      flash(tasks[currentStep].type === 'pause' ? 'rgba(107,197,168,0.2)' : 'rgba(232,197,71,0.2)');

      // Windows notification
      const finishedName = tasks[currentStep].name;
      const nextTask = tasks[currentStep + 1];
      const notifBody = nextTask
        ? `Up next: ${nextTask.name} (${nextTask.minutes} min)`
        : 'Session complete!';
      sendNotification(`‚è± ${finishedName} done`, notifBody);

      setTimeout(() => {
        if (currentStep < tasks.length - 1) {
          currentStep++;
          totalSecondsLeft = tasks.slice(currentStep).reduce((s, t) => s + t.minutes * 60, 0);
          startStep();
        } else {
          finishSession();
        }
      }, 800);
    }
  }

  function updateClock() {
    const m = Math.floor(secondsLeft / 60);
    const s = secondsLeft % 60;
    const str = `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
    const clock = document.getElementById('clock');
    clock.textContent = str;
    clock.classList.toggle('warning', secondsLeft <= 60 && secondsLeft > 0 && tasks[currentStep].type !== 'pause');
    clock.classList.toggle('is-pause', tasks[currentStep].type === 'pause');

    const tr = totalSecondsLeft;
    const th = Math.floor(tr / 3600);
    const tm = Math.floor((tr % 3600) / 60);
    const ts = tr % 60;
    const totalStr = th > 0
      ? `${th}h ${tm}m remaining in session`
      : `${tm}m ${String(ts).padStart(2,'0')}s remaining in session`;
    document.getElementById('total-left').textContent = totalStr;
  }

  function togglePause() {
    isPaused = !isPaused;
    document.getElementById('pause-resume-btn').textContent = isPaused ? 'RESUME' : 'PAUSE';
    beep(isPaused ? 440 : 660, 0.08);
  }

  function nextStep() {
    clearInterval(timerInterval);
    if (currentStep < tasks.length - 1) {
      totalSecondsLeft -= secondsLeft;
      currentStep++;
      startStep();
    } else {
      finishSession();
    }
  }

  function finishSession() {
    clearInterval(timerInterval);
    document.getElementById('timer-view').style.display = 'none';
    const dv = document.getElementById('done-view');
    dv.style.display = 'flex';
    const taskCount = tasks.filter(t => t.type === 'task').length;
    const pauseCount = tasks.filter(t => t.type === 'pause').length;
    document.getElementById('done-stats').textContent =
      `${taskCount} task${taskCount !== 1 ? 's' : ''} ¬∑ ${pauseCount} break${pauseCount !== 1 ? 's' : ''} completed`;
    sendNotification('üéâ Session Complete!', `${taskCount} tasks finished. Great work!`);
    alertSound(); setTimeout(alertSound, 500);
  }

  function backToEditor() {
    clearInterval(timerInterval);
    document.getElementById('timer-view').style.display = 'none';
    document.getElementById('done-view').style.display = 'none';
    document.getElementById('editor').style.display = 'block';
    renderEditor();
  }

  function renderQueue() {
    const q = document.getElementById('queue');
    q.innerHTML = '';
    tasks.forEach((t, i) => {
      const item = document.createElement('div');
      item.className = 'queue-item' +
        (i === currentStep ? ' current' + (t.type === 'pause' ? ' is-pause' : '') : '') +
        (i < currentStep ? ' done' : '');
      item.innerHTML = `
        <span class="queue-item-name">${escHtml(t.name)}</span>
        <span class="queue-item-dur">${t.minutes}min</span>
      `;
      q.appendChild(item);
    });
  }

  // ‚îÄ‚îÄ Init ‚îÄ‚îÄ
  tasks = [
    { name: 'Task 1', minutes: 30, type: 'task' },
    { name: 'Pause',  minutes: 5,  type: 'pause' },
    { name: 'Task 2', minutes: 25, type: 'task' },
    { name: 'Task 3', minutes: 15, type: 'task' },
    { name: 'Pause',  minutes: 5,  type: 'pause' },
  ];
  renderEditor();
  checkNotifBanner();
</script>
</body>
</html>